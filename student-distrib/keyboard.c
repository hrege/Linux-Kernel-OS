#include "keyboard.h"
#include "i8259.h"
#include "lib.h"

unsigned char scancode_map[NUM_SCANCODES][NUM_CASES] = {
      { 0x00, 0x00, 0x00, 0x00 }, /* Nothing */
      { 0x1B, 0x1B, 0x1B, 0x1B }, /* ESC */
      { 0x31, 0x21, 0x31, 0x21 }, /* 1 */
      { 0x32, 0x40, 0x32, 0x40 }, /* 2 */
      { 0x33, 0x23, 0x33, 0x23 }, /* 3 */
      { 0x34, 0x24, 0x34, 0x24 }, /* 4 */
      { 0x35, 0x25, 0x35, 0x25 }, /* 5 */
      { 0x36, 0x5E, 0x36, 0x5E }, /* 6 */
      { 0x37, 0x26, 0x37, 0x26 }, /* 7 */
      { 0x38, 0x2A, 0x38, 0x2A }, /* 8 */
      { 0x39, 0x28, 0x39, 0x28 }, /* 9 */
      { 0x30, 0x29, 0x30, 0x29 }, /* 0 */
      { 0x2D, 0x5F, 0x2D, 0x5F }, /* - */
      { 0x3D, 0x2B, 0x3D, 0x2B }, /* = */
      { 0x08, 0x08, 0x08, 0x08 }, /* BKSP */
      { 0x09, 0x09, 0x09, 0x09 }, /* TAB */
      { 0x71, 0x51, 0x51, 0x71 }, /* Q */
      { 0x77, 0x57, 0x57, 0x77 }, /* W */
      { 0x65, 0x45, 0x45, 0x65 }, /* E */
      { 0x72, 0x52, 0x52, 0x72 }, /* R */
      { 0x74, 0x54, 0x54, 0x74 }, /* T */
      { 0x79, 0x59, 0x59, 0x79 }, /* Y */
      { 0x75, 0x55, 0x55, 0x75 }, /* U */
      { 0x69, 0x49, 0x49, 0x69 }, /* I */
      { 0x6F, 0x4F, 0x4F, 0x6F }, /* O */
      { 0x70, 0x50, 0x50, 0x70 }, /* P */
      { 0x5B, 0x7B, 0x5B, 0x7B }, /* [ */
      { 0x5D, 0x7D, 0x5D, 0x7D }, /* ] */
      { 0x0A, 0x0A, 0x0A, 0x0A }, /* ENTER */
      { 0x00, 0x00, 0x00, 0x00 }, /* LCTRL */
      { 0x61, 0x41, 0x41, 0x61 }, /* A */
      { 0x73, 0x53, 0x53, 0x73 }, /* S */
      { 0x64, 0x44, 0x44, 0x64 }, /* D */
      { 0x66, 0x46, 0x46, 0x66 }, /* F */
      { 0x67, 0x47, 0x47, 0x67 }, /* G */
      { 0x68, 0x48, 0x48, 0x68 }, /* H */
      { 0x6A, 0x4A, 0x4A, 0x6A }, /* J */
      { 0x6B, 0x4B, 0x4B, 0x6B }, /* K */
      { 0x6C, 0x4C, 0x4C, 0x6C }, /* L */
      { 0x3B, 0x3A, 0x3B, 0x3A }, /* ; */
      { 0x27, 0x22, 0x27, 0x22 }, /* ' */
      { 0x60, 0x7E, 0x60, 0x7E }, /* ` */
      { 0x00, 0x00, 0x00, 0x00 }, /* LSHIFT */
      { 0x5C, 0x7C, 0x5C, 0x7C }, /* \ */
      { 0x7A, 0x5A, 0x5A, 0x7A }, /* Z */
      { 0x78, 0x58, 0x58, 0x78 }, /* X */
      { 0x63, 0x43, 0x43, 0x63 }, /* C */
      { 0x76, 0x56, 0x56, 0x76 }, /* V */
      { 0x62, 0x42, 0x42, 0x62 }, /* B */
      { 0x6E, 0x4E, 0x4E, 0x6E }, /* N */
      { 0x6D, 0x4D, 0x4D, 0x6D }, /* M */
      { 0x2C, 0x3C, 0x2C, 0x3C }, /* , */
      { 0x2E, 0x3E, 0x2E, 0x3E }, /* . */
      { 0x2F, 0x3F, 0x2F, 0x3F }, /* / */
      { 0x00, 0x00, 0x00, 0x00 }, /* RSHIFT */
      { 0x00, 0x00, 0x00, 0x00 }, /* PRTSC */
      { 0x00, 0x00, 0x00, 0x00 }, /* LALT */
      { 0x20, 0x20, 0x20, 0x20 }, /* SPACE */
      { 0x00, 0x00, 0x00, 0x00 }, /* CAPS */
      { 0x00, 0x00, 0x00, 0x00 }, /* F1 */
      { 0x00, 0x00, 0x00, 0x00 }, /* F2 */
      { 0x00, 0x00, 0x00, 0x00 }, /* F3 */
      { 0x00, 0x00, 0x00, 0x00 }, /* F4 */
      { 0x00, 0x00, 0x00, 0x00 }, /* F5 */
      { 0x00, 0x00, 0x00, 0x00 }, /* F6 */
      { 0x00, 0x00, 0x00, 0x00 }, /* F7 */
      { 0x00, 0x00, 0x00, 0x00 }, /* F8 */
      { 0x00, 0x00, 0x00, 0x00 }, /* F9 */
      { 0x00, 0x00, 0x00, 0x00 }, /* F10 */
      { 0x00, 0x00, 0x00, 0x00 }, /* NUMLOCK */
      { 0x00, 0x00, 0x00, 0x00 }, /* SCROLLLOCK */
      { 0x00, 0x00, 0x00, 0x00 }, /* NUMPAD7 */
      { 0x00, 0x00, 0x00, 0x00 }, /* NUMPAD8 */
      { 0x00, 0x00, 0x00, 0x00 }, /* NUMPAD9 */
      { 0x00, 0x00, 0x00, 0x00 }, /* NUMPAD- */
      { 0x00, 0x00, 0x00, 0x00 }, /* NUMPAD7 */
      { 0x00, 0x00, 0x00, 0x00 }, /* NUMPAD7 */
      { 0x00, 0x00, 0x00, 0x00 }, /* NUMPAD7 */
      { 0x00, 0x00, 0x00, 0x00 }, /* NUMPAD+ */
      { 0x00, 0x00, 0x00, 0x00 }, /* NUMPAD1 */
      { 0x00, 0x00, 0x00, 0x00 }, /* NUMPAD2 */
      { 0x00, 0x00, 0x00, 0x00 }, /* NUMPAD3 */
      { 0x00, 0x00, 0x00, 0x00 }, /* NUMPAD0 */
      { 0x00, 0x00, 0x00, 0x00 }, /* NUMPAD. */
      { 0x00, 0x00, 0x00, 0x00 }, /* UNUSED */
      { 0x00, 0x00, 0x00, 0x00 }, /* UNUSED */
      { 0x00, 0x00, 0x00, 0x00 }, /* UNUSED */
      { 0x00, 0x00, 0x00, 0x00 }, /* F11 */
      { 0x00, 0x00, 0x00, 0x00 }, /* F12 */

      /* The rest of the scancodes are not used */
      { 0x00, 0x00, 0x00, 0x00 },
      { 0x00, 0x00, 0x00, 0x00 },
      { 0x00, 0x00, 0x00, 0x00 },
      { 0x00, 0x00, 0x00, 0x00 },
      { 0x00, 0x00, 0x00, 0x00 },
      { 0x00, 0x00, 0x00, 0x00 },
      { 0x00, 0x00, 0x00, 0x00 },
      { 0x00, 0x00, 0x00, 0x00 },
      { 0x00, 0x00, 0x00, 0x00 },
      { 0x00, 0x00, 0x00, 0x00 },
      { 0x00, 0x00, 0x00, 0x00 },
      { 0x00, 0x00, 0x00, 0x00 },
      { 0x00, 0x00, 0x00, 0x00 },
      { 0x00, 0x00, 0x00, 0x00 },
      { 0x00, 0x00, 0x00, 0x00 },
      { 0x00, 0x00, 0x00, 0x00 },
      { 0x00, 0x00, 0x00, 0x00 },
      { 0x00, 0x00, 0x00, 0x00 },
      { 0x00, 0x00, 0x00, 0x00 },
      { 0x00, 0x00, 0x00, 0x00 },
      { 0x00, 0x00, 0x00, 0x00 },
      { 0x00, 0x00, 0x00, 0x00 },
      { 0x00, 0x00, 0x00, 0x00 },
      { 0x00, 0x00, 0x00, 0x00 },
      { 0x00, 0x00, 0x00, 0x00 },
      { 0x00, 0x00, 0x00, 0x00 },
      { 0x00, 0x00, 0x00, 0x00 },
      { 0x00, 0x00, 0x00, 0x00 },
      { 0x00, 0x00, 0x00, 0x00 },
      { 0x00, 0x00, 0x00, 0x00 },
      { 0x00, 0x00, 0x00, 0x00 },
      { 0x00, 0x00, 0x00, 0x00 },
      { 0x00, 0x00, 0x00, 0x00 },
      { 0x00, 0x00, 0x00, 0x00 },
      { 0x00, 0x00, 0x00, 0x00 },
      { 0x00, 0x00, 0x00, 0x00 },
      { 0x00, 0x00, 0x00, 0x00 },
      { 0x00, 0x00, 0x00, 0x00 },
      { 0x00, 0x00, 0x00, 0x00 }

};


void keyboard_init() {
  enable_irq(1);
}

void keyboard_handler() {
  unsigned char keyboard_status = 0;
  char keyboard_input = 0;

  keyboard_input = inb(0x60);

  if(keyboard_input > 0) {
    printf("%c\n", getScancode(keyboard_input));
  }

  send_eoi(1);
}

char getScancode(char input) {
  return scancode_map[input][0];
}
